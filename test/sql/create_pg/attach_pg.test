# name: test/sql/create_pg/attach_pg.test
# description: Testing create property graph with an attached database
# group: [duckpgq_sql_create_pg]

require duckpgq

statement ok
attach '/Users/dljtw/git/duckpgq/data/bluesky.duckdb';

statement ok
select * from bluesky.follows;

statement ok
-CREATE OR REPLACE PROPERTY GRAPH bluesky
            VERTEX TABLES (bluesky.account LABEL account)
            EDGE TABLES (bluesky.follows    SOURCE KEY (source) REFERENCES bluesky.account (did)
                                            DESTINATION KEY (destination) REFERENCES bluesky.account (did)
            LABEL follows);

statement ok
-FROM GRAPH_TABLE (bluesky MATCH (a:account));

statement ok
-FROM GRAPH_TABLE (bluesky MATCH (a:account)-[f:follows]->(b:account));

query II
-FROM GRAPH_TABLE (bluesky MATCH (a:account)-[f:follows]->(b:account) COLUMNS (a.did as a_id, b.did as b_id)) ORDER BY a_id, b_id LIMIT 10;
----
did:plc:23df55poeztue4terk3s5ain	did:plc:274qq3cgl4vrrofdg77balfw
did:plc:23df55poeztue4terk3s5ain	did:plc:2ktpgfwt7cc2osldzh6uyww5
did:plc:23df55poeztue4terk3s5ain	did:plc:2p5eadzea3yb2ghwtzrlaebo
did:plc:23df55poeztue4terk3s5ain	did:plc:37drmtazrclxzxezzk4ijuk7
did:plc:23df55poeztue4terk3s5ain	did:plc:42qpqlgojbezm3gt2nxdfikk
did:plc:23df55poeztue4terk3s5ain	did:plc:45g7v5rojoj4tpspb7fg6dvp
did:plc:23df55poeztue4terk3s5ain	did:plc:4kv7ldgzot7q4w4y65kpsbwo
did:plc:23df55poeztue4terk3s5ain	did:plc:4nt6nwx353a3xxo5mzjiy4ha
did:plc:23df55poeztue4terk3s5ain	did:plc:6k63663icgdybm5evgszxjn2
did:plc:23df55poeztue4terk3s5ain	did:plc:7562tstpez4aexd75ttshl3z

query II
-FROM GRAPH_TABLE (bluesky MATCH (a:account)-[f:follows]->{1,3}(b:account) COLUMNS (a.did as a_id, b.did as b_id)) ORDER BY a_id, b_id LIMIT 10;
----
did:plc:23df55poeztue4terk3s5ain	did:plc:274qq3cgl4vrrofdg77balfw
did:plc:23df55poeztue4terk3s5ain	did:plc:2ktpgfwt7cc2osldzh6uyww5
did:plc:23df55poeztue4terk3s5ain	did:plc:2p5eadzea3yb2ghwtzrlaebo
did:plc:23df55poeztue4terk3s5ain	did:plc:37drmtazrclxzxezzk4ijuk7
did:plc:23df55poeztue4terk3s5ain	did:plc:42qpqlgojbezm3gt2nxdfikk
did:plc:23df55poeztue4terk3s5ain	did:plc:45g7v5rojoj4tpspb7fg6dvp
did:plc:23df55poeztue4terk3s5ain	did:plc:4kv7ldgzot7q4w4y65kpsbwo
did:plc:23df55poeztue4terk3s5ain	did:plc:4nt6nwx353a3xxo5mzjiy4ha
did:plc:23df55poeztue4terk3s5ain	did:plc:6k63663icgdybm5evgszxjn2
did:plc:23df55poeztue4terk3s5ain	did:plc:7562tstpez4aexd75ttshl3z